<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.fm.user.dao.UserCompanyFileMapper">

    <sql id="Base_Columns_List">
        cfid,cfname,cfclassifyid,cfclassifyname,cfaddress,cfdate,cfeditor,cfaccept,
        cfsend,cflevel,cffontid,cfnumber,cflanguage ,cfloader,type,isborrow,waitborrow,
        destroy,back,backDate,destroyDate,leveltime,state
    </sql>

    <insert id="insertCompanyFile" parameterType="cn.fm.pojo.CompanyFile" >
        insert into companyFile(cfname,cfclassifyid,cfclassifyname,cfaddress,cfdate,cfeditor,cfaccept,
        cfsend,cflevel,cffontid,cfnumber,cflanguage,cfloader , leveltime,) values(#{cfname},
        #{cfclassifyid} ,#{cfclassifyname},#{cfaddress},#{cfdate},#{cfeditor},#{cfaccept},
        #{cfsend},#{cflevel},#{cffontid},#{cfnumber},#{cflanguage},#{cfloader}, #{leveltime})
    </insert>

    <select id="selectClassify" parameterType="java.lang.Integer" resultType="cn.fm.pojo.Classify">
        select cyid,cyname,cyfatherid,cyaddress from classify where cyid =#{value}
    </select>

    <select id="selectCompanyFileById" parameterType="int" resultType="cn.fm.pojo.CompanyFile">
        select
        <include refid="Base_Columns_List" />
        from companyFile where cfid = #{cfid} and state=1
    </select>

    <select id="selectCompanyFileByName" parameterType="java.lang.String" resultType="cn.fm.pojo.CompanyFile">
        select
        <include refid="Base_Columns_List" />
        from companyFile where cfname like concat(concat('%',#{value}), '%') and state=1
    </select>


    <select id="selectCompanyFileByClassifyId" parameterType="java.lang.Integer" resultType="cn.fm.pojo.CompanyFile">
        select
        <include refid="Base_Columns_List" />
        from companyFile where cfclassifyid = #{value} and state=1
    </select>


    <select id="selectCompanyFileByDateTime" parameterType="java.lang.String" resultType="cn.fm.pojo.CompanyFile">
        select
        <include refid="Base_Columns_List" />
        from companyFile where cfdate &gt;= #{date} and cfdate &lt;= #{endtime} and state=1
    </select>

    <select id="selectCompanyFileByFontid" parameterType="java.lang.String" resultType="cn.fm.pojo.CompanyFile">
        select
        <include refid="Base_Columns_List" />
        from companyFile where cffontid = #{value} and state=1
    </select>

    <select id="selectCompanyFileByLanguage" parameterType="java.lang.String" resultType="cn.fm.pojo.CompanyFile">
        select
        <include refid="Base_Columns_List" />
        from companyFile where cflanguage = #{value} and state = 1
    </select>
    <!--


   -->
    <select id="selectAllCompanyFile" resultType="cn.fm.pojo.CompanyFile">
        select
        <include refid="Base_Columns_List" />
        from companyFile where state=1
    </select>

    <!--修改文件信息-->
    <update id="updateCompanyFileById" parameterType="cn.fm.pojo.CompanyFile">
        update companyFile
        <set>
        <if test="cfname != null">
            cfname = #{cfname} ,
        </if>
        <if test="cfdate != null" >
            cfdate = #{cfdate} ,
        </if>
        <if test="cfeditor != null" >
            cfeditor = #{cfeditor} ,
        </if>
        <if test="cfaccept != null" >
            cfaccept = #{cfaccept} ,
        </if>
        <if test="cfsend != null" >
            cfsend = #{cfsend},
        </if>
        <if test="cflevel != null" >
            cflevel = #{cflevel},
        </if>
        <if test="cfloader != null" >
            cfloader = #{cfloader},
        </if>
        <if test="cfnumber != 0" >
            cfnumber = #{cfnumber},
        </if>
        <if test="cffontid != null">
            cffontid = #{cffontid},
        </if>
        <if test="cflanguage != null">
            cflanguage = #{cflanguage},
        </if>
        <if test="cfclassifyid != 0" >
            cfclassifyid = #{cfclassifyid},
        </if>
        <if test="cfclassifyname != null">
            cfclassifyname = #{cfclassifyname} ,
        </if>
        <if test="cfaddress != null">
            cfaddress = #{cfaddress},
        </if>
        <if test="isborrow != 0">
            isborrow = #{isborrow}
        </if>
        </set>
        where cfid  = #{cfid}
    </update>

    <select id="selectCompanyFileByTwoOrMore" resultType="cn.fm.pojo.CompanyFile">
        select
        <include refid="Base_Columns_List" />
        from companyFile
        <where>
            <if test="companyFile.cffontid != null">
                cffontid=#{companyFile.cffontid}
            </if>
            <if test="companyFile.cflanguage != null" >
              and  cflanguage = #{companyFile.cflanguage}
            </if>
            <if test="companyFile.cfname != null">
                AND  cfname like concat(concat('%',#{companyFile.cfname}), '%')
            </if>
            <if test="companyFile.cfclassifyid != 0" >
               AND cfclassifyid = #{companyFile.cfclassifyid}
            </if>
            <if test="companyFile.cfdate != null">
                AND cfdate &gt;= #{companyFile.cfdate} and cfdate &lt;= #{endtime}
            </if>
            AND state=1
        </where>
    </select>
    <!--查询是不是有借阅信息-->
    <select id="selectCFhasBorrowInfo" resultType="cn.fm.pojo.Borrow" parameterType="int">
        select * from borrow_companyFile where fileid = #{id}
    </select>
    <!--删除文件信息-->
    <update id="deleteCompanyFileById" parameterType="int">
       update  companyFile set state=0
        <where>
            cfid IN
            <foreach collection="cfid" open="(" close=")" separator="," item="id">
                #{id}
            </foreach>
        </where>
    </update>

   <update id="deleteCompanyFileBorrowInfo" parameterType="int">
       update borrow_companyFile set state=0
       <where>
           fileid=#{cfid}
       </where>
   </update>
    <!--查看被删除的文件-->
    <select id="selectTheCFileIsDel" resultType="cn.fm.pojo.CompanyFile" >
        select
        <include refid="Base_Columns_List" />
        from companyFile where state = 0
    </select>

    <!--销毁一个文件-->
    <update id="delCompanyFileDestroy" parameterType="java.lang.Integer" >
        UPDATE companyFile SET destroy = 0 , destroyDate = #{destroyDate} where cfid = #{cfid}
    </update>
    <!--清退一个文件 修改清退文件的日期-->
    <update id="delCompanyFileBack" >
        UPDATE companyFile SET back = 1,backDate=#{backDate} where cfid = #{cfid}
    </update>

</mapper>